<html xmlns:th="http://www.thymeleaf.org" th:replace="starter">
<meta charset="utf-8" />
<div class="row" th:fragment="contenido">

	<!-- ## SECCION DE PROUDCTOS  -->

	<div class="col-md-6">
		<div class="box box-default">
			<div class="box-header with-border">
				<h3 class="box-title">Productos</h3>

				<div class="box-tools pull-right">
					<button type="button" class="btn btn-box-tool"
						data-widget="collapse">
						<i class="fa fa-minus"></i>
					</button>
					<button type="button" class="btn btn-box-tool" data-widget="remove">
						<i class="fa fa-remove"></i>
					</button>
				</div>
			</div>
			<!-- /.box-header -->
			<div class="box-body">
				<div class="row">
					<div class="col-md-12">
						<div class="form-group">
							<label>Busqueda</label>
							<div class="box-body">
								<div id="magicsuggest"></div>
							</div>
							<!-- /.box-body -->
						</div>
						<!-- /.form-group -->
						<div class="form-group">
							<label for="inputNombre">C贸digo:</label> 
							<input name="codigo" type="text" class="form-control" id="codigo"
							data-validation="required">
							<input name="id" type="hidden" id="id">
						</div>
						<div class="form-group">
							<label for="inputNombre">Nombre:</label> 
							<input type="text" class="form-control" id="nombre" name="nombre"
							placeholder="Ingrese Nombre"
							data-validation="required"
			 				data-validation-error-msg-required="Debe ingresar el nombre del cliente">	
						</div>
					</div>
					<!-- /.col -->
					<div class="col-md-6">
						<div class="form-group">
							<label>Precio Venta:</label>
							<div class="input-group">
								<div class="input-group-addon">
									<i class="fa fa-usd"></i>
								</div>
								<input type="text" class="form-control" id="precioVenta" name="precioVenta"
							placeholder="Ingrese Precio de Venta"
							data-validation="required"
			 				data-validation-error-msg-required="Debe ingresar el precio de venta">

							</div>
							<!-- /.input group -->
						</div>
					</div>

					<div class="col-md-6">
						<div class="form-group">
							<label>Stock Actual:</label>

							<div class="input-group">
								<div class="input-group-addon">
									<i class="fa fa-hashtag"></i>
								</div>
								<input type="text" class="form-control" id="stockActual" name="stockActual">
							</div>
							<!-- /.input group -->
						</div>
					</div>

					<div class="col-md-6">
						<div class="form-group">
							<label>Cantidad:</label>
							<div class="input-group">
								<div class="input-group-addon">
									<i class="fa fa-usd"></i>
								</div>
								<input type="text" class="form-control" id="cantidad" name="cantidad"
							placeholder="Ingrese cantidad"
							data-validation="required"
			 				data-validation-error-msg-required="Debe ingresar la cantidad">
							</div>
							<!-- /.input group -->
						</div>
					</div>
					<!-- /.col -->
				</div>
				<!-- /.row -->
			</div>
			<!-- /.box-body -->
			<div class="modal-footer">
				<button type="button" class="btn btn-success" onclick="agregarDetalle()">
					<span class="glyphicon glyphicon-shopping-cart"></span> Agregar
					Producto
				</button>
			</div>
		</div>
	</div>

	<!-- #### SECCION DE VENTA -->


	<div class="col-md-6">
		<div class="box box-default">
			<div class="box-header with-border">
				<h3 class="box-title">Venta</h3>

				<div class="box-tools pull-right">
					<button type="button" class="btn btn-box-tool"
						data-widget="collapse">
						<i class="fa fa-minus"></i>
					</button>
					<button type="button" class="btn btn-box-tool" data-widget="remove">
						<i class="fa fa-remove"></i>
					</button>
				</div>
			</div>
			<!-- /.box-header -->
			<div class="box-body">
				<div class="row">
					<div class="col-md-12">

						<!-- total a pagar  -->
						<div class="col-md-12">
							<div class="form-group">
								<label>Cliente:</label>
								<div class="box-body">
									<div id="magicsuggestCliente"></div>
								</div>
								<!-- /.box-body -->
							</div>
						<div class="col-md-6">
							<div class="form-group">
								<label>Sub-Total:</label>

								<div class="input-group">
									<div class="input-group-addon">
										<i class="fa fa-usd"></i>
									</div>
									<input type="text" class="form-control" id="subTotal" name="subTotal"
							placeholder="Ingrese sub-total"
							data-validation="required"
			 				data-validation-error-msg-required="Debe ingresar monto sin iva">
								</div>
								<!-- /.input group -->
							</div>
						</div>
						<div class="col-md-6">
							<div class="form-group">
								<label for="exampleInputFile">Fecha:</label>
									<input type="date" class="form-control" id="fechaVenta" name="fechaVenta"
							placeholder="Ingrese fecha"
							data-validation="required"
			  				data-validation-error-msg-required="Ingrese fecha en la cual se realizo la venta">
							</div>
						</div>
						
						<label>Total:</label>
						<div class="col-md-12">
							<div class="form-group">
								<div class="input-group">
									<div class="input-group-addon">
										<i class="fa fa-usd"></i>
									</div>
									<input type="text" class="form-control input-money" value="0.0">
								</div>
								<!-- /.input group -->
							</div>
						</div>
						
						
						</div>
						<div class="modal-footer">
							<button type="button" class="btn btn-primary">
								<span class="glyphicon glyphicon-ok"></span> Confirmar
							</button>
						</div>
					</div>
				</div>
				<!-- /.row -->
			</div>
			<!-- /.box-body -->
			
		</div>
	</div>
	
        <div class="col-xs-12">
          <div class="box">
            <div class="box-header">
              <h3 class="box-title">Productos Agregados</h3>
            </div>
            <!-- /.box-header -->
            <div class="box-body table-responsive no-padding" id="tableDetail">
              <table class="table table-hover" id="tabla-detalle">
                <tbody><tr>
                  <th>C贸digo</th>
                  <th>Nombre</th>
                  <th>Cant.</th>
                  <th>Precio Unit.</th>
                  <th>Precio Total</th>
                  <th>Acci贸n</th>
                </tr>
                <tr>
                  <td>183</td>
                  <td>Cocal Cola de ejemplo</td>
                  <td>2</td>
                  <td>5.000</td>
                  <td>10.000</td>
                  <td><button type="button" class="btn btn-danger" onclick="removerDetalle()">
								<span class="glyphicon glyphicon-remove"></span>
							</button>
					</td>
                </tr>
              </tbody></table>
            </div>
            <!-- /.box-body -->
          </div>
          <!-- /.box -->
        </div>


	<script type="text/javascript">
		$(document).ready(
				function() {
					var suggestProducto = crearMagicSuggest('magicsuggest',
							"[[@{/producto/suggest}]]", 'id', 'descripcion');
					crearMagicSuggest('magicsuggestCliente',
							"[[@{/cliente/suggest}]]", 'id', 'nombre');
					
					//buscar producto
					$(suggestProducto).on('selectionchange', function(a,b,c){
						if (c.length == 0){
							$("#codigo").val("");
							$("#nombre").val("");
							$("#precioVenta").val("");
							$("#cantidad").val("");
							$("#stockActual").val("");
							$("#id").val("");
						}else{
							var producto = c[0];
							$("#codigo").val(producto.codigo);
							$("#nombre").val(producto.descripcion);
							$("#precioVenta").val(producto.precioVenta);
							$("#cantidad").val(1);
							$("#stockActual").val(producto.cantidad);
							$("#id").val(producto.id);
						}
						
						  console.log("cambi贸 el valor del maicsuggest: " + this.getValue());
						});
					1
					var fecha = new Date();
					var dd = fecha.getDate();
					var mm = (fecha.getMonth() +1);
					dd=addZero(dd);
					mm=addZero(mm);
					fechaActual = fecha.getFullYear()+"-"+mm+"-"+dd;
					$("#fechaVenta").val(fechaActual);
					
					function addZero(i) {
					    if (i < 10) {
					        i = '0' + i;
					    }
					    return i;
					}
					
				});
		
		
		function agregarDetalle(){
			var idProduto = $("#id").val();
			var cantidad = $("#cantidad").val();
			$.ajax({
		        type: "POST",
		        url: "/gestionart/venta/agregar-detalle",
		        data: { 
		        	id_producto: idProduto,
		        	cantidad: cantidad
		        }
		    }).done(function(data){
		    	//agregamos una fila mas al table de detalle
		    	data.replace("<html>");
		    	$('#tableDetail tbody').append(data);
		    	$("#textError").html("Producto agregado corretamente al detalle");
		    	$('html, body').animate({scrollTop: 0}, 800);

		    	$("#alerta").fadeIn(2000);
				$("#alerta").fadeOut(8000);
// 		    	$('#tableDetail').html(data);
		        
		    }).fail(function (request, status, error) {
	   	        var errorData = request.responseJSON;
		    });
		}
		
		function removerDetalle(idProducto){
			
			$.ajax({
		        type: "POST",
		        url: "/gestionart/venta/eliminar-detalle",
		        data: { 
		        	id_producto: idProduto,
		        }
		    }).done(function(data){
		    	//eliminamos una fila mas al table de detalle
		    	$('#tableDetail tbody').append(data);
		    	$("#textError").html("Producto agregado corretamente al detalle");
		    	

		    	$("#alerta").fadeIn(2000);
				$("#alerta").fadeOut(8000);
// 		    	$('#tableDetail').html(data);
		        
		    }).fail(function (request, status, error) {
	   	        var errorData = request.responseJSON;
		    });
		}
	</script>
</div>
</html>